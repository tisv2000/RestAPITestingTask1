#Решение задания по автоматизации тестирования REST API

##Задание

Создать и выложить на GitHub или BitBucket проект автотестов API сервиса http://fish-text.ru/api

1. Разработать тест кейсы (настолько полно, насколько считаете нужным)
2. Составить тест-план регрессионного тестирования
3. Автоматизировать тест-план:
* проект должен быть написан на java (версия 8+)
* проект должен собираться посредством maven
* тесты должны быть оформлены в виде файлов .feature (Cucumber framework)
* тесты должны быть разделены на группы для возможности их раздельного запуска

Пожелания:
* Выполнение действий с API должно происходить через один java класс
* Количество повторений кода должно быть минимальным


##Тест-план регрессионного тестирования

###Application Under Test
REST API сайта http://fish-text.ru/api

>Рыбатекст используется дизайнерами, проектировщиками и фронтендерами, когда нужно быстро заполнить макеты или прототипы содержимым. Это тестовый контент, который не должен нести никакого смысла, лишь показать наличие самого текста или продемонстрировать типографику в деле.
>
>C помощью этого онлайн-генератора рыботекста можно пачками плодить как отдельные предложения, так и целые абзацы отменнейшего рыбы-текста. А для любителей автоматизации даже реализован API фиштекста.

API позволяет:
* Запрашивать текст в виде набора предложений, абзацев или заголовков (определяется параметром `type`).
* Указывать количество предложений/абзацев/заголовков (параметр `number`).
* Выбирать формат, в котором вернется текст (JSON или HTML) (параметр `format`).

###Анализ Application Under Test
В процессе анализа были выявлены следующие особенности, по сути являющиеся багами:

* При `format=json` сайт передает заголовок `Content-Type: text/html`, а не `application/json`.
* При `format=html` возвращаемый сайтом документ не содержит корневого тега, что не дает RestAssured нормально его распарсить, что, в свою очередь, лишает нас возможности использовать XPath.
* Допустимыми значениями для `number` являются диапазоны 1-100 и 1-500. Однако, нулевое значение принимается нормально, при этом используется значение по умолчанию. 
* Некорректное значение для `number` (т.е. не числа) спокойно принимаются, при этом используется значение по умолчанию.
* При указании отрицательного значения `number` при `format=html`, поведение приложения отличается от поведения для других форматов. Мы будем считать это багом, поэтому **как минимум один тест у нас будет падать**.
* Некорректные значения для `type` и `format` спокойно принимаются. В этом случае используются значения по умолчанию.

Данные особенности будут учтены далее в тест-плане.

###Используемые техники тест-дизайна
* Equivalence class testing
* Boundary testing
* Test matrix
* DDT

###Тестируемые функции
Должны быть протестированы все возможные комбинации параметров запроса, приведенные в [описании](http://fish-text.ru/api). В том числе ситуации, когда любой из параметров не указан.

При этом, для параметра `number` необходимо учесть граничные условия и классы эквивалентности, которых существует несколько:
* Допустимые значения: 1-100 для абзацев и 1-500 для предложений и заголовков.
* Нулевое значение: по идее, это тоже не допустимое значение, но в этом случае используется значение по умолчанию
 (1 - для заголовков и 3 - для предложений и абзацев).
* Отрицательные значения (недопустимые значения).
* Не числовые значения (недопустимые значения).

Для позитивных тест-кейсов необходимо проверять:
* Status Code ответа сервера
* Поле `status` в JSON, полученом с сервера (только для `format=json`)
* Соответствие количества полученных предложений/параграфов/заголовков запрошенному значению `number`

Для негативных текст-кейсов необходимо проверять:
* Status Code ответа сервера
* Поле `status` в JSON, полученом с сервера (только для `format=json`)
* Текст сообщения об ошибке

###Тест-кейсы
Полный перечень параметров запросов для всех тестов приведен в [матрице](https://drive.google.com/open?id=1eIT7GlUStORdLDSV015jx6Fp1GPl9zFslxRn7TZSzhQ).

Каждая клетка, помеченная идентификатором (числом, начинающимся с символа '#'), является отдельным тест-кейсом.

В клетках таблицы кроме номера указана вспомогательная информация по тест-кейсу.

Таким образом, в результате комбинации параметров запроса получается 66 тест-кейсов.

Кроме указанных в таблице, также необходимы следующие тест-кейсы:

* \#67: Опущен параметр `type`. Должно быть использовано значение по умолчанию (`sentence`).
* \#68: Опущен параметр `format`. Должно быть использовано значение по умолчанию (`json`).
* \#69: Указано недопустимое значение `type`. Должно быть сообщение об ошибке, однако вместо этого используется значение по умолчанию.
* \#70: Указано недопустимое значение `format`. Должно быть сообщение об ошибке, однако вместо этого используется значение по умолчанию.
* \#71: Указано недопустимое значение `type` и `format` одновременно. Должно быть сообщение об ошибке, однако вместо этого используются значения по умолчанию.
* \#72: Параметр `type` указан два раза.
* \#73: Параметр `format` указан два раза.
* \#74: Параметр `number` указан два раза.
* \#75: Проверка ограничений на количество запросов в минуту.
* \#76: Указан не GET запрос, а POST.
 

Общее количество тест-кейсов: 76.

###Автоматизация
Исходя из соображений, приведенных в разделе *“Анализ Application Under Test”*,  тест-кейсы #7, #14, #21, #28, #35, #42, #45, #46, #49, #50, #53, #54, #57, #58, #61, #62, #65, #66 и с #67 по #76 автоматизироваться не будут.

Итого: будет автоматизировано 48 тест-кейсов, не будет - 28.

В рамках данного задания мануальные тест-кейсы подробно расписываться не будут.

С учетом применения DDT, для 48-ти тест-кейсов необходимо реализовать всего 4 тестовых сценария:
* Positive JSON
* Positive HTML
* Negative JSON
* Negative HTML

Автоматизация будет произведена на Java 8 с использованием RestAssured и Cucumber.

###Особенности автоматизации тест-кейсов
Я взяла на себя смелость расширить задание и реализовать не один, а четыре набора тестовых сценариев:
* без Cucumber - package `withoutcucumber`.
* с Cucumber - package `withcucumber`.

Причем с Cucumber я решила сделать три варианта:
* с использованием аннотаций (на ветке `master`)
* с использованием cucumber-java8 (на ветке `cucumber-java8`)
* с ипсользованием cucumber expressions (на ветке `cucumber-java8-expr`)

В итоге получилось четыре набора тестовых сценариев (один без Cucumber и три - с Cucumber).

В каждом наборе реализуется по четыре тестовых сценария. И каждый набор выполняет по 48 тест-кейсов.

Для возможности раздельного запуска тестовых сценариев (только для наборов с Cucumber) они будут помечены следующими тегами:
* @Positive - все позитивные тесты
* @Negative - все негативные тесты
* @FormatJson - негативные и позитивные тесты для JSON
* @FormatHtml - негативные и позитивные тесты для HTML

##Результат тестирования
Результат тестирования приведен [здесь](https://drive.google.com/open?id=1Q9YU6vkdHI_v6E7NIISs7ENZJKq6N2rHy4v6yG4xIz8).

Итого: passed: 47, failed: 1

##Получение проекта

        cd <your_projects_directory>
        git clone https://bitbucket.org/tisv2000/cardpaytesttask.git CardPayTestTask
        cd CardPayTestTask

##Запуск автотестов

Возможны следующие варианты запуска автотестов:

* Запуск всех тестов (с Cucumber и без). Выполнится 96 тестов, два упадет.

        mvn test

* Запуск всех тестов без Cucumber. Выполнится 48 тестов, один упадет.

        mvn test -Dtest=FishTextTest

* Запуск всех тестов с Cucumber (здесь и далее возможен выбор одной из трех веток, как указано выше). Выполнится 48 тестов, один упадет.

        mvn test -Dtest=CucumberStarterTest

* Запуск только позитивных тестов (с Cucumber). Выполнится 36 тестов.

        mvn test -Dtest=CucumberStarterTest -Dcucumber.options="--tags @Positive"

* Запуск только негативных тестов (с Cucumber). Выполнится 12 тестов, один упадет.

        mvn test -Dtest=CucumberStarterTest -Dcucumber.options="--tags @Negative" 

* Запуск только тестов для JSON (с Cucumber). Выполнится 24 тестов.

        mvn test -Dtest=CucumberStarterTest -Dcucumber.options="--tags @FormatJson" 

* Запуск только тестов для HTML (с Cucumber). Выполнится 24 тестов, один упадет.

        mvn test -Dtest=CucumberStarterTest -Dcucumber.options="--tags @FormatHtml" 